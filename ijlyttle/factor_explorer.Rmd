---
title: "factor_explorer"
runtime: shiny
output: html_document
---

## Intro

ggvis is amlmost there, but not quite, so I'll use ggplot.

## Libraries

At some point, we should make sure we agree on which versions of which packages we propose to use. As a starting point, I can show what I am using:

```{r load_libraries, message=FALSE}
library(stringr)
library(ggplot2)
library(dplyr)
library(tidyr)
library(lubridate)
library(shiny)
```

Here's my versions:

```{r session_info}
sessionInfo()
```

```{r load_data}
sets <- c("item", "parent", "school", "scoredItem", "student")

# function to build the file names
fn_build <- function(file_name){
 
  template <- c("2012.rda", "2012dict.rda")
 
  file_name %>% 
    vapply(str_join, template, template) %>% 
    file.path("..", "data", .)
}

# load the data
sets %>% fn_build %>% lapply(load, .GlobalEnv)

# clean
rm(fn_build, sets)
```

The dictionaries are stored as named vectors - I would prefer data frames so that I can use the RStudio GUI to examine them.

```{r modify_dictionaries}
# function to convert to data-frames
fn_make_df <- function(named_vector){
  data.frame(
    variable = attr(named_vector, "names"),
    description = named_vector,
    row.names = NULL
  )
}

# there's a clever way to do this, but beyond me for naw
dict_item2012 <- fn_make_df(item2012dict) 
dict_parent2012 <- fn_make_df(parent2012dict) 
dict_school2012 <- fn_make_df(school2012dict) 
dict_scoredItem2012 <- fn_make_df(scoredItem2012dict) 
dict_student2012 <- fn_make_df(student2012dict) 

# clean
rm(fn_make_df)
rm(item2012dict, parent2012dict, school2012dict, scoredItem2012dict, student2012dict)
```

## Shiny app

We are told that we can put a shiny app into an Rmarkdown document - let's try that.

The thought is that we could use this (I wish we had another couple weeks) to discover the interesting relationships, then turn those into posters.

```{r shiny_variable_lists}
var_names_student <- dict_student2012$variable
names(var_names_student) <- 
  dict_student2012$description %>%
  str_replace_all("\x92", "'") # gets rid of funny characters"
```

```{r shiny_inputs}
selectInput(
  "test",
  "variable",
  choices = var_names_student
)
```


